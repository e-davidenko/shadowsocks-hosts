// Shadowsocks PAC (global-by-default)
// Всё через SOCKS5 127.0.0.1:1080, кроме локалок и правил @@ (DIRECT).
// Если хочешь "только список через прокси, остальное DIRECT", см. переключатель DEFAULT_BEHAVIOR ниже.

var PROXY = "SOCKS5 127.0.0.1:1080";
var DIRECT = "DIRECT";

// ---- РЕЖИМ ПО УМОЛЧАНИЮ ----
// "proxy"  -> всё через прокси (кроме локалок и @@)
// "direct" -> только указанные в proxyRules идут через прокси, остальное DIRECT
var DEFAULT_BEHAVIOR = "proxy";

// --- ЛОКАЛЬНЫЕ ИСКЛЮЧЕНИЯ ---
function isLocal(host) {
  return isPlainHostName(host)
      || shExpMatch(host, "*.local")
      || isInNet(host, "10.0.0.0", "255.0.0.0")
      || isInNet(host, "172.16.0.0", "255.240.0.0")
      || isInNet(host, "192.168.0.0", "255.255.0.0")
      || isInNet(host, "127.0.0.0", "255.0.0.0")
      || isInNet(host, "169.254.0.0", "255.255.0.0");
}

// --- ВСПОМОГАТЕЛЬНЫЕ ---
function matchDomain(host, domain) {
  // домен и все поддомены
  return host === domain || shExpMatch(host, "*." + domain);
}

function fromRuleToDomain(rule) {
  // срезаем префиксы вида "||"
  if (rule.indexOf("||") === 0) return rule.substring(2);
  return rule;
}

// --- ТВОИ ПРАВИЛА ---
// @@ -> белый список (DIRECT)
var whiteRules = [
  "rshb.ru",
  "rshbintech.ru"
];

// Остальное -> список «кандидатов» на прокси
var proxyRules = [
  "chat.openai.com",
  "instagram.com",
  "cdn.oaistatic.com",
  "ab.chatgpt.com",
  "chatgpt.com",
  "auth.openai.com",
  "auth0.openai.com",
  "rutracker.org",
  "static.rutracker.cc",
  "s181.convertio.me",
  "copilot.microsoft.com",
  "static.cdninstagram.com",
  "googlevideo.com",
  "youtube.com",
  "ytimg.com",
  "x.ai",
  "grok.com",
  "liquibase.com",
  "jetbrains.com",
  "oaiusercontent.com",
  "camunda.io",
  "ggpht.com",
  "l.google.com",
  "play.google.com",
  "youtubei.googleapis.com",
  "youtu.be",
  "nhacmp3youtube.com",
  "googleusercontent.com",
  "discord.gg",
  "cdn.discordapp.com",
  "canary.discord.com",
  "dis.gd",
  "ptb.discord.com",
  "discord-attachments-uploads-prd.storage.googleapis.com",
  "discord-activities.com",
  "discord.co",
  "discord.com",
  "discord.design",
  "discord.dev",
  "discord.gift",
  "discord.gifts",
  "discord.media",
  "discord.new",
  "discord.store",
  "discord.tools",
  "discordactivities.com",
  "discordapp.com",
  "discordapp.net",
  "media.discordapp.net",
  "images-ext-1.discordapp.net",
  "images-ext-2.discordapp.net",
  "stable.dl2.discordapp.net",
  "discordcdn.com",
  "discordmerch.com",
  "discordpartygames.com",
  "discordsays.com",
  "discordsez.com",
  "discordstatus.com",
  "monica.im",
  "videos.openai.com",
  "jetbrains.com"
];

function inList(host, list) {
  for (var i = 0; i < list.length; i++) {
    var d = fromRuleToDomain(list[i]);
    if (matchDomain(host, d)) return true;
  }
  return false;
}

function FindProxyForURL(url, host) {
  // 1) локалки — всегда в обход
  if (isLocal(host)) return DIRECT;

  // 2) белый список @@ — в обход
  if (inList(host, whiteRules)) return DIRECT;

  // 3) режим "только список через прокси"
  if (DEFAULT_BEHAVIOR === "direct") {
    if (inList(host, proxyRules)) return PROXY + "; " + DIRECT;
    return DIRECT;
  }

  // 4) режим "глобально через прокси" (по умолчанию)
  // (proxyRules тут не обязателен, но оставлен как «подсказка» — всё равно уйдёт в прокси)
  return PROXY + "; " + DIRECT;
}
